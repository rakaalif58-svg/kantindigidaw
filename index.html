<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>shoIsho</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
            background-color: #f8fafc; /* slate-50 */
        }
        .animate-fade-in-up {
            animation: fadeInUp 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) both;
        }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .btn-primary {
            background-image: linear-gradient(to right, #10b981, #059669);
            color: white;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px 0 rgba(5, 150, 105, 0.3);
        }
        .btn-primary:hover {
            box-shadow: 0 6px 20px 0 rgba(5, 150, 105, 0.4);
            transform: translateY(-2px);
        }
        .btn-secondary {
            background-color: #f1f5f9; /* slate-100 */
            color: #334155; /* slate-700 */
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .btn-secondary:hover {
            background-color: #e2e8f0; /* slate-200 */
        }
        .card {
            background-color: white;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.05), 0 4px 6px -4px rgb(0 0 0 / 0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.07), 0 8px 10px -6px rgb(0 0 0 / 0.07);
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
        }
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: capitalize;
        }
        .status-pending, .status-baru { background-color: #fef9c3; color: #a16207; }
        .status-completed, .status-selesai { background-color: #dcfce7; color: #166534; }
        .status-cancelled { background-color: #fee2e2; color: #991b1b; }
        .status-diproses { background-color: #cffafe; color: #0891b2; }

        .admin-sidebar-link {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            color: #475569;
            font-weight: 500;
            transition: background-color 0.2s ease, color 0.2s ease;
        }
        .admin-sidebar-link:hover {
            background-color: #e2e8f0;
            color: #1e293b;
        }
        .admin-sidebar-link.active {
            background-color: #10b981;
            color: white;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
    </style>
</head>
<body class="bg-slate-50">

    <div id="app">
        <!-- Konten aplikasi akan dirender di sini oleh JavaScript -->
    </div>

    <script>
        // --- MOCK DATABASE & SETTINGS ---
        let appSettings = {
            commissionRate: 10,
            notifications: {
                newOrder: true,
                newComplaint: true,
            },
            canteenSchedule: {
                senin: { open: '08:00', close: '16:00', isOpen: true },
                selasa: { open: '08:00', close: '16:00', isOpen: true },
                rabu: { open: '08:00', close: '16:00', isOpen: true },
                kamis: { open: '08:00', close: '16:00', isOpen: true },
                jumat: { open: '08:00', close: '16:00', isOpen: true },
                sabtu: { open: '09:00', close: '14:00', isOpen: false },
                minggu: { open: '09:00', close: '14:00', isOpen: false },
            }
        };

        const mockPermissions = {
            admin: [
                { id: 'manage_users', label: 'Kelola Pengguna', granted: true },
                { id: 'manage_settings', label: 'Kelola Pengaturan', granted: true },
                { id: 'view_finance', label: 'Lihat Keuangan', granted: true },
            ],
            penjual: [
                { id: 'manage_products', label: 'Kelola Produk', granted: true },
                { id: 'manage_orders', label: 'Kelola Pesanan', granted: true },
                { id: 'view_finance', label: 'Lihat Keuangan', granted: false },
            ],
            pembeli: [
                { id: 'place_order', label: 'Buat Pesanan', granted: true },
                { id: 'submit_complaint', label: 'Kirim Pengaduan', granted: true },
                { id: 'manage_products', label: 'Kelola Produk', granted: false },
            ]
        };

        let mockUsers = [
            { uid: 'admin01', name: 'Admin Utama', email: 'admin@email.com', password: 'password123', role: 'admin', isActive: true },
            { uid: 'penjual01', name: 'Kantin Bu Ida', email: 'penjual@email.com', password: 'password123', role: 'penjual', storeStatus: 'open', isActive: true },
            { 
              uid: 'siswa01', name: 'Budi Santoso', email: 'siswa@email.com', password: 'password123', role: 'pembeli', isActive: true,
              address: { street: 'Jl. Kantin No. 123', city: 'Jakarta', note: 'Rumah pagar hijau' },
              preferences: { extraSauce: true, noOnions: false },
              notificationSettings: { orderStatus: true, promos: true },
              favorites: ['p01']
            }
        ];

        let mockProducts = [
            { id: 'p01', sellerId: 'penjual01', name: 'Nasi Goreng Spesial', price: 15000, available: true, imageUrl: 'https://placehold.co/600x400/a7f3d0/14532d?text=Nasi+Goreng' },
            { id: 'p02', sellerId: 'penjual01', name: 'Mie Ayam Bakso', price: 12000, available: true, imageUrl: 'https://placehold.co/600x400/a7f3d0/14532d?text=Mie+Ayam' },
            { id: 'p03', sellerId: 'penjual01', name: 'Es Teh Manis', price: 3000, available: true, imageUrl: 'https://placehold.co/600x400/a7f3d0/14532d?text=Es+Teh' },
        ];
        
        let mockOrders = [];
        let mockComplaints = [];
        let adminEarnings = 0;

        // --- GLOBAL APP STATE ---
        const state = {
            currentUser: null,
            currentPage: 'login',
            adminCurrentView: 'stats',
            pembeliSettingsView: 'profil',
            searchQuery: '',
            cart: [],
            notification: { message: '', type: '' },
            isProductModalOpen: false, editingProduct: null,
            isUserModalOpen: false, editingUser: null,
            isComplaintModalOpen: false,
        };

        window.app = {
            state,
            handleRegister, handleLogin, handleLogout,
            navigateTo, setAdminView, setPembeliSettingsView,
            setNotification,
            openProductModal, closeProductModal,
            openUserModal, closeUserModal,
            openComplaintModal, closeComplaintModal,
            addToCart, updateCartQuantity, removeFromCart, checkout,
            handleProductFormSubmit, handleDeleteProduct,
            updateOrderStatus, toggleStoreStatus,
            handleUserFormSubmit, toggleUserStatus,
            handleComplaintSubmit, updateComplaintStatus,
            handleSettingsUpdate,
            setSearchQuery,
            handleBackupData, handleRestoreData,
            handleProfileUpdate, handlePasswordChange, handleStudentSettingsUpdate,
            toggleFavorite,
        };
        
        const appContainer = document.getElementById('app');

        // --- RENDER ENGINE ---
        function render() {
            appContainer.innerHTML = '';
            showNotification();
            const role = state.currentUser?.role;
            let pageHTML = '';
            switch (state.currentPage) {
                case 'login': pageHTML = LoginPage(); break;
                case 'loginPembeli': pageHTML = LoginPagePembeli(); break;
                case 'loginPenjual': pageHTML = LoginPagePenjual(); break;
                case 'loginAdmin': pageHTML = LoginPageAdmin(); break;
                case 'register': pageHTML = RegisterPage(); break;
                case 'adminDashboard': pageHTML = role === 'admin' ? AdminDashboardPage() : NotAuthorizedPage(); break;
                case 'penjualDashboard': pageHTML = role === 'penjual' ? PenjualDashboardPage() : NotAuthorizedPage(); break;
                case 'pembeliMenu': pageHTML = role === 'pembeli' ? PembeliMenuPage() : NotAuthorizedPage(); break;
                case 'pembeliCart': pageHTML = role === 'pembeli' ? PembeliCartPage() : NotAuthorizedPage(); break;
                case 'pembeliSettings': pageHTML = role === 'pembeli' ? PembeliSettingsPage() : NotAuthorizedPage(); break;
                default: pageHTML = LoginPage();
            }
            appContainer.innerHTML = pageHTML;

            if (state.isProductModalOpen && (role === 'penjual' || role === 'admin')) appContainer.insertAdjacentHTML('beforeend', ProductModal());
            if (state.isUserModalOpen && role === 'admin') appContainer.insertAdjacentHTML('beforeend', UserModal());
            if (state.isComplaintModalOpen && role === 'pembeli') appContainer.insertAdjacentHTML('beforeend', ComplaintModal());
            
            lucide.createIcons();
        }
        window.app.render = render;

        // --- NAVIGATION & ROUTING ---
        function navigateTo(page) {
            state.currentPage = page;
            render();
        }
        function setAdminView(view) { 
            state.adminCurrentView = view; 
            render(); 
        }
         function setPembeliSettingsView(view) {
            state.pembeliSettingsView = view;
            render();
        }

        // --- AUTHENTICATION & USER ---
        function handleRegister(event) {
            event.preventDefault();
            const { name, email, password, role } = event.target.elements;
            if (mockUsers.find(u => u.email.value === email.value)) {
                return setNotification('Email sudah terdaftar.', 'error');
            }
            const newUser = { 
              uid: 'user' + Date.now(), name: name.value, email: email.value, password: password.value, role: role.value, isActive: true,
              address: {}, preferences: {}, notificationSettings: {}, favorites: []
            };
            if (newUser.role === 'penjual') newUser.storeStatus = 'open';
            mockUsers.push(newUser);
            setNotification('Akun berhasil dibuat! Silakan masuk.', 'success');
            navigateTo('login');
        }

        function handleLogin(event) {
            event.preventDefault();
            const { email, password } = event.target.elements;
            const user = mockUsers.find(u => u.email === email.value && u.password === password.value);
            if (user) {
                if (!user.isActive) {
                    return setNotification('Akun Anda telah dinonaktifkan.', 'error');
                }
                state.currentUser = { ...user };
                const roleRoutes = { admin: 'adminDashboard', penjual: 'penjualDashboard', pembeli: 'pembeliMenu' };
                navigateTo(roleRoutes[state.currentUser.role] || 'login');
            } else {
                setNotification('Email atau sandi salah.', 'error');
            }
        }

        function handleLogout() {
            state.currentUser = null;
            state.cart = [];
            state.searchQuery = '';
            navigateTo('login');
        }
        
        function setSearchQuery(query) {
            state.searchQuery = query;
            render();
        }

        // --- MODAL & NOTIFICATION ---
        function openProductModal(productId = null) {
            state.editingProduct = productId ? mockProducts.find(p => p.id === productId) : null;
            state.isProductModalOpen = true;
            render();
        }
        function closeProductModal() {
            state.isProductModalOpen = false;
            state.editingProduct = null;
            render();
        }
        function openUserModal(userId = null) {
            state.editingUser = userId ? mockUsers.find(u => u.uid === userId) : null;
            state.isUserModalOpen = true;
            render();
        }
        function closeUserModal() {
            state.isUserModalOpen = false;
            state.editingUser = null;
            render();
        }
         function openComplaintModal() {
            state.isComplaintModalOpen = true;
            render();
        }
        function closeComplaintModal() {
            state.isComplaintModalOpen = false;
            render();
        }
        function setNotification(message, type = 'success') {
            state.notification = { message, type };
            showNotification();
            setTimeout(() => {
                state.notification = { message: '', type: '' };
                const notifEl = document.getElementById('notification-banner');
                if (notifEl) notifEl.remove();
            }, 3000);
        }
        function showNotification() {
            const existingNotif = document.getElementById('notification-banner');
            if(existingNotif) existingNotif.remove();
            if (state.notification.message) {
                const bgColor = state.notification.type === 'success' ? 'bg-emerald-500' : 'bg-rose-500';
                const notifHTML = `<div id="notification-banner" class="fixed top-5 right-5 ${bgColor} text-white py-2 px-4 rounded-lg shadow-lg animate-fade-in-up z-50">${state.notification.message}</div>`;
                document.body.insertAdjacentHTML('beforeend', notifHTML);
            }
        }
        
        // --- CART LOGIC ---
        function addToCart(productId) {
            const product = mockProducts.find(p => p.id === productId);
            if (!product) return;
            const cartItem = state.cart.find(item => item.id === productId);
            if (cartItem) cartItem.quantity++;
            else state.cart.push({ ...product, quantity: 1 });
            render(); 
        }
        function updateCartQuantity(productId, change) {
            const cartItem = state.cart.find(item => item.id === productId);
            if (!cartItem) return;
            cartItem.quantity += change;
            if (cartItem.quantity <= 0) removeFromCart(productId);
            else render();
        }
        function removeFromCart(productId) {
            state.cart = state.cart.filter(item => item.id !== productId);
            render();
        }
        function checkout() {
            if (state.cart.length === 0) return setNotification('Keranjang Anda kosong.', 'error');
            const ordersBySeller = state.cart.reduce((acc, item) => {
                (acc[item.sellerId] = acc[item.sellerId] || []).push(item);
                return acc;
            }, {});
            for (const sellerId in ordersBySeller) {
                const items = ordersBySeller[sellerId];
                const total = items.reduce((sum, item) => sum + item.price * item.quantity, 0);
                mockOrders.push({ id: `order${Date.now()}${sellerId}`, userId: state.currentUser.uid, sellerId, items, total, status: 'pending' });
            }
            state.cart = [];
            setNotification('Pesanan berhasil dibuat!', 'success');
            navigateTo('pembeliMenu');
        }
        
        // --- MANAGEMENT LOGIC (PRODUCT, USER, ETC) ---
        function handleProductFormSubmit(event) {
            event.preventDefault();
            const { name, price, imageUrl } = event.target.elements;
            if (state.editingProduct) {
                const product = mockProducts.find(p => p.id === state.editingProduct.id);
                if (product) Object.assign(product, { name: name.value, price: parseInt(price.value), imageUrl: imageUrl.value });
                setNotification('Produk berhasil diperbarui.', 'success');
            } else {
                mockProducts.push({ id: 'p' + Date.now(), sellerId: state.currentUser.uid, name: name.value, price: parseInt(price.value), imageUrl: imageUrl.value, available: true });
                setNotification('Produk berhasil ditambahkan.', 'success');
            }
            closeProductModal();
        }
        function handleDeleteProduct(productId) {
            mockProducts = mockProducts.filter(p => p.id !== productId);
            render();
            setNotification('Produk berhasil dihapus.', 'success');
        }
        function handleUserFormSubmit(event) {
            event.preventDefault();
            const { name, email, role, password } = event.target.elements;
            if (state.editingUser) {
                const user = mockUsers.find(u => u.uid === state.editingUser.uid);
                if (user) Object.assign(user, { name: name.value, email: email.value, role: role.value });
                setNotification('Data pengguna diperbarui.', 'success');
            } else {
                if (mockUsers.find(u => u.email === email.value)) return setNotification('Email sudah terdaftar.', 'error');
                const newUser = { uid: 'user' + Date.now(), name: name.value, email: email.value, password: password.value, role: role.value, isActive: true };
                if (newUser.role === 'penjual') newUser.storeStatus = 'open';
                mockUsers.push(newUser);
                setNotification('Pengguna baru ditambahkan.', 'success');
            }
            closeUserModal();
        }
        function toggleUserStatus(userId) {
            const user = mockUsers.find(u => u.uid === userId);
            if (user) {
                user.isActive = !user.isActive;
                render();
                setNotification(`Status ${user.name} diubah menjadi ${user.isActive ? 'Aktif' : 'Nonaktif'}.`, 'success');
            }
        }
        function updateOrderStatus(orderId, newStatus) {
            const order = mockOrders.find(o => o.id === orderId);
            if (order) {
                if (order.status !== 'completed' && newStatus === 'completed') {
                    const commission = order.total * (appSettings.commissionRate / 100);
                    adminEarnings += commission;
                    order.commission = commission; 
                }
                order.status = newStatus;
                render();
                setNotification(`Status pesanan diubah menjadi ${newStatus}.`, 'success');
            }
        }
        function toggleStoreStatus(userId) {
            const user = mockUsers.find(u => u.uid === userId);
            if (user && user.role === 'penjual') {
                user.storeStatus = user.storeStatus === 'open' ? 'closed' : 'open';
                render();
                setNotification(`Status toko ${user.name} diubah.`, 'success');
            }
        }
        function handleComplaintSubmit(event) {
            event.preventDefault();
            const { subject, description } = event.target.elements;
            const newComplaint = {
                id: 'comp' + Date.now(),
                userId: state.currentUser.uid,
                subject: subject.value,
                description: description.value,
                status: 'baru', // baru, diproses, selesai
                timestamp: new Date().toISOString()
            };
            mockComplaints.push(newComplaint);
            setNotification('Laporan Anda telah dikirim.', 'success');
            closeComplaintModal();
        }
        function updateComplaintStatus(complaintId, newStatus) {
            const complaint = mockComplaints.find(c => c.id === complaintId);
            if (complaint) {
                complaint.status = newStatus;
                render();
                setNotification('Status laporan diperbarui.', 'success');
            }
        }
        function handleSettingsUpdate(event) {
            event.preventDefault();
            const form = event.target;
            
            appSettings.commissionRate = parseFloat(form.commissionRate.value);
            appSettings.notifications.newOrder = form.notif_newOrder.checked;
            appSettings.notifications.newComplaint = form.notif_newComplaint.checked;

            Object.keys(appSettings.canteenSchedule).forEach(day => {
                appSettings.canteenSchedule[day] = {
                    open: form[`${day}_open`].value,
                    close: form[`${day}_close`].value,
                    isOpen: form[`${day}_isOpen`].checked,
                };
            });
            
            setNotification('Pengaturan aplikasi telah disimpan.', 'success');
            render();
        }

        function handleBackupData() {
            const dataToBackup = { appSettings, mockUsers, mockProducts, mockOrders, mockComplaints, adminEarnings };
            const backupJson = JSON.stringify(dataToBackup, null, 2);
            const blob = new Blob([backupJson], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `shoIsho_backup_${new Date().toISOString().slice(0,10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            setNotification('Backup data berhasil diunduh.', 'success');
        }

        function handleRestoreData() {
            const backupInput = document.getElementById('restore-file');
            if (backupInput.files.length === 0) return setNotification('Silakan pilih file backup terlebih dahulu.', 'error');
            const file = backupInput.files[0];
            const reader = new FileReader();
            reader.onload = function(event) {
                try {
                    const restoredData = JSON.parse(event.target.result);
                    if (restoredData.appSettings && restoredData.mockUsers) {
                        appSettings = restoredData.appSettings;
                        mockUsers = restoredData.mockUsers;
                        mockProducts = restoredData.mockProducts;
                        mockOrders = restoredData.mockOrders;
                        mockComplaints = restoredData.mockComplaints;
                        adminEarnings = restoredData.adminEarnings;
                        setNotification('Data berhasil dipulihkan. Halaman akan dimuat ulang.', 'success');
                        setTimeout(() => window.location.reload(), 2000);
                    } else {
                        throw new Error("Format file backup tidak valid.");
                    }
                } catch (e) {
                    setNotification(`Gagal memulihkan data: ${e.message}`, 'error');
                }
            };
            reader.readAsText(file);
        }

        // --- Student Settings ---
        function handleProfileUpdate(event) {
            event.preventDefault();
            const { name, email } = event.target.elements;
            const user = mockUsers.find(u => u.uid === state.currentUser.uid);
            if (user) {
                user.name = name.value;
                user.email = email.value;
                state.currentUser.name = name.value; // Update current session
                state.currentUser.email = email.value;
                setNotification('Profil berhasil diperbarui.', 'success');
                render();
            }
        }
        function handlePasswordChange(event) {
            event.preventDefault();
            const { oldPassword, newPassword, confirmPassword } = event.target.elements;
            const user = mockUsers.find(u => u.uid === state.currentUser.uid);
            if (user && user.password === oldPassword.value) {
                if (newPassword.value === confirmPassword.value) {
                    user.password = newPassword.value;
                    setNotification('Kata sandi berhasil diubah.', 'success');
                    event.target.reset();
                } else {
                    setNotification('Konfirmasi sandi baru tidak cocok.', 'error');
                }
            } else {
                setNotification('Sandi lama salah.', 'error');
            }
        }
        function handleStudentSettingsUpdate(event) {
            event.preventDefault();
            const form = event.target;
            const user = mockUsers.find(u => u.uid === state.currentUser.uid);
            if (user) {
                // Update Address
                user.address = { street: form.street.value, city: form.city.value, note: form.note.value };
                // Update Preferences
                user.preferences = { extraSauce: form.extraSauce.checked, noOnions: form.noOnions.checked };
                // Update Notifications
                user.notificationSettings = { orderStatus: form.orderStatus.checked, promos: form.promos.checked };

                state.currentUser = {...user}; // Sync state
                setNotification('Pengaturan berhasil disimpan.', 'success');
                render();
            }
        }
        function toggleFavorite(productId) {
            const user = mockUsers.find(u => u.uid === state.currentUser.uid);
            if (!user) return;
            if (!user.favorites) user.favorites = [];
            const favIndex = user.favorites.indexOf(productId);
            if (favIndex > -1) {
                user.favorites.splice(favIndex, 1);
                setNotification('Dihapus dari favorit.', 'info');
            } else {
                user.favorites.push(productId);
                setNotification('Ditambahkan ke favorit.', 'success');
            }
            // also update current user state
            state.currentUser.favorites = user.favorites;
            render();
        }

        // --- UI COMPONENTS ---
        function NotAuthorizedPage() { return `<div class="min-h-screen flex flex-col items-center justify-center text-center p-4"><i data-lucide="shield-alert" class="w-24 h-24 text-red-500"></i><h1 class="text-3xl font-bold mt-4">Akses Ditolak</h1><p class="text-gray-600 mt-2">Anda tidak memiliki izin untuk melihat halaman ini.</p><button onclick="window.app.handleLogout()" class="mt-6 btn-primary py-2 px-4 rounded-lg">Kembali ke Login</button></div>`; }
        
        function AppHeader(title) {
            const cartItemCount = state.cart.reduce((total, item) => total + item.quantity, 0);
            const isPembeli = state.currentUser.role === 'pembeli';
            return `<header class="bg-white shadow-md sticky top-0 z-20"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex items-center justify-between h-16"><div class="flex items-center"><i data-lucide="utensils-crossed" class="w-8 h-8 text-emerald-500"></i><h1 class="text-xl font-bold ml-2 text-gray-800">${title}</h1></div><div class="flex items-center gap-4">${isPembeli ? `<button onclick="window.app.navigateTo('pembeliMenu')" class="text-gray-500 hover:text-emerald-600" title="Menu"><i data-lucide="layout-grid" class="w-6 h-6"></i></button><button onclick="window.app.openComplaintModal()" class="text-gray-500 hover:text-emerald-600" title="Laporkan Masalah"><i data-lucide="message-square-warning" class="w-6 h-6"></i></button><button onclick="window.app.navigateTo('pembeliCart')" class="relative text-gray-500 hover:text-emerald-600" title="Keranjang"><i data-lucide="shopping-cart" class="w-6 h-6"></i>${cartItemCount > 0 ? `<span class="absolute -top-2 -right-2 bg-rose-500 text-white text-xs w-5 h-5 rounded-full flex items-center justify-center">${cartItemCount}</span>` : ''}</button><button onclick="window.app.navigateTo('pembeliSettings')" class="text-gray-500 hover:text-emerald-600" title="Pengaturan"><i data-lucide="settings" class="w-6 h-6"></i></button>` : ''}<span class="text-gray-600 hidden sm:block">Halo, ${state.currentUser.name}!</span><button onclick="window.app.handleLogout()" class="text-gray-500 hover:text-emerald-600" title="Keluar"><i data-lucide="log-out" class="w-6 h-6"></i></button></div></div></div></header>`;
        }

        // --- LOGIN & REGISTER PAGES ---
        function LoginPage() { return `<div class="min-h-screen flex items-center justify-center p-4 bg-cover bg-center" style="background-image: url('https://images.unsplash.com/photo-1555396273-367ea4eb4db5?q=80&w=1974&auto=format&fit=crop')"><div class="absolute inset-0 bg-black bg-opacity-40"></div><div class="relative w-full max-w-lg bg-white rounded-2xl shadow-xl p-8 animate-fade-in-up text-center"><i data-lucide="utensils-crossed" class="w-16 h-16 mx-auto text-emerald-500"></i><h1 class="text-3xl font-bold text-gray-800 mt-4">Selamat Datang di shoIsho</h1><p class="text-gray-500 mt-2 mb-8">Silakan masuk sesuai peran Anda di kantin.</p><div class="space-y-4"><button onclick="window.app.navigateTo('loginPembeli')" class="w-full text-left p-4 rounded-lg border hover:bg-slate-50 transition flex items-center"><i data-lucide="user" class="w-8 h-8 mr-4 text-emerald-500"></i><div><h2 class="font-bold text-lg">Masuk sebagai Siswa</h2><p class="text-sm text-gray-500">Lihat menu dan pesan makanan.</p></div></button><button onclick="window.app.navigateTo('loginPenjual')" class="w-full text-left p-4 rounded-lg border hover:bg-slate-50 transition flex items-center"><i data-lucide="store" class="w-8 h-8 mr-4 text-amber-500"></i><div><h2 class="font-bold text-lg">Masuk sebagai Penjual Kantin</h2><p class="text-sm text-gray-500">Kelola menu dan pesanan Anda.</p></div></button><button onclick="window.app.navigateTo('loginAdmin')" class="w-full text-left p-4 rounded-lg border hover:bg-slate-50 transition flex items-center"><i data-lucide="shield-check" class="w-8 h-8 mr-4 text-sky-500"></i><div><h2 class="font-bold text-lg">Masuk sebagai Admin</h2><p class="text-sm text-gray-500">Akses panel kontrol utama.</p></div></button></div><p class="text-center mt-6 text-sm text-gray-600">Belum punya akun? <a href="#" onclick="window.app.navigateTo('register')" class="font-semibold text-emerald-600 hover:underline">Daftar di sini</a></p></div></div>`; }
        function createLoginPage(role, icon, color, title, subtitle) { return `<div class="min-h-screen flex items-center justify-center p-4 bg-cover bg-center" style="background-image: url('https://images.unsplash.com/photo-1555396273-367ea4eb4db5?q=80&w=1974&auto=format&fit=crop')"><div class="absolute inset-0 bg-black bg-opacity-40"></div><div class="relative w-full max-w-md bg-white rounded-2xl shadow-xl p-8 animate-fade-in-up"><div class="text-center mb-8"><i data-lucide="${icon}" class="w-16 h-16 mx-auto text-${color}-500"></i><h1 class="text-3xl font-bold text-gray-800 mt-4">${title}</h1><p class="text-gray-500 mt-2">${subtitle}</p></div><form onsubmit="window.app.handleLogin(event)"><div><label for="email" class="block text-sm font-medium text-gray-600 mb-1">Email</label><input type="email" id="email" name="email" required class="w-full px-4 py-3 bg-slate-100 border-transparent rounded-lg focus:ring-${color}-500 focus:border-${color}-500" placeholder="nama@email.com"></div><div class="mt-4"><label for="password" class="block text-sm font-medium text-gray-600 mb-1">Sandi</label><input type="password" id="password" name="password" required class="w-full px-4 py-3 bg-slate-100 border-transparent rounded-lg focus:ring-${color}-500 focus:border-${color}-500" placeholder="••••••••"></div><button type="submit" class="w-full btn-primary py-3 px-4 rounded-lg mt-6">Masuk</button></form><p class="text-center mt-4 text-sm text-gray-600"><a href="#" onclick="window.app.navigateTo('login')" class="font-semibold text-emerald-600 hover:underline">Kembali ke pilihan login</a></p></div></div>`;}
        function LoginPagePembeli() { return createLoginPage('pembeli', 'utensils', 'emerald', 'Login Siswa', 'Masuk untuk memesan makanan.'); }
        function LoginPagePenjual() { return createLoginPage('penjual', 'store', 'amber', 'Login Penjual Kantin', 'Masuk ke dashboard kantin Anda.'); }
        function LoginPageAdmin() { return createLoginPage('admin', 'shield-check', 'sky', 'Login Admin', 'Masuk ke panel kontrol utama.'); }
        function RegisterPage() { return `<div class="min-h-screen flex items-center justify-center p-4 bg-cover bg-center" style="background-image: url('https://images.unsplash.com/photo-1555396273-367ea4eb4db5?q=80&w=1974&auto=format&fit=crop')"><div class="absolute inset-0 bg-black bg-opacity-40"></div><div class="relative w-full max-w-md bg-white rounded-2xl shadow-xl p-8 animate-fade-in-up"><h1 class="text-3xl font-bold text-center text-gray-800 mb-6">Buat Akun Baru</h1><form onsubmit="window.app.handleRegister(event)"><div><label for="name" class="block text-sm font-medium text-gray-600 mb-1">Nama Lengkap</label><input type="text" id="name" name="name" required class="w-full px-4 py-3 bg-slate-100 border-transparent rounded-lg focus:ring-emerald-500 focus:border-emerald-500" placeholder="Nama Anda"></div><div class="mt-4"><label for="email" class="block text-sm font-medium text-gray-600 mb-1">Email</label><input type="email" id="email" name="email" required class="w-full px-4 py-3 bg-slate-100 border-transparent rounded-lg focus:ring-emerald-500 focus:border-emerald-500" placeholder="nama@email.com"></div><div class="mt-4"><label for="password" class="block text-sm font-medium text-gray-600 mb-1">Sandi</label><input type="password" id="password" name="password" required class="w-full px-4 py-3 bg-slate-100 border-transparent rounded-lg focus:ring-emerald-500 focus:border-emerald-500" placeholder="Minimal 6 karakter"></div><div class="mt-4"><label for="role" class="block text-sm font-medium text-gray-600 mb-1">Saya ingin mendaftar sebagai:</label><select id="role" name="role" required class="w-full px-4 py-3 bg-slate-100 border-transparent rounded-lg focus:ring-emerald-500 focus:border-emerald-500"><option value="pembeli">Siswa</option><option value="penjual">Penjual Kantin</option></select></div><button type="submit" class="w-full btn-primary py-3 px-4 rounded-lg mt-6">Daftar</button></form><p class="text-center mt-4 text-sm text-gray-600">Sudah punya akun? <a href="#" onclick="window.app.navigateTo('login')" class="font-semibold text-emerald-600 hover:underline">Masuk di sini</a></p></div></div>`; }
        
        // --- Pembeli (Siswa) Views ---
        function isCanteenOpenNow() {
            const now = new Date();
            const days = ['minggu', 'senin', 'selasa', 'rabu', 'kamis', 'jumat', 'sabtu'];
            const today = days[now.getDay()];
            
            const schedule = appSettings.canteenSchedule[today];
            if (!schedule || !schedule.isOpen) {
                return false; // Canteen is closed for the day
            }

            const currentTime = now.toTimeString().slice(0, 5); // "HH:MM"
            return currentTime >= schedule.open && currentTime <= schedule.close;
        }

        function PembeliMenuPage() {
            const canteenIsOpen = isCanteenOpenNow();
            let productCards = '';

            if (canteenIsOpen) {
                const filteredProducts = mockProducts.filter(p => {
                    const seller = mockUsers.find(u => u.uid === p.sellerId);
                    const matchesSearch = p.name.toLowerCase().includes(state.searchQuery.toLowerCase());
                    return p.available && seller && seller.storeStatus === 'open' && matchesSearch;
                });

                productCards = filteredProducts.map(product => {
                    const seller = mockUsers.find(u => u.uid === product.sellerId);
                    const itemInCart = state.cart.find(item => item.id === product.id);
                    const isFavorite = state.currentUser.favorites?.includes(product.id);
                    const actionButtonHTML = itemInCart
                        ? `<div class="flex items-center gap-2"><button onclick="window.app.updateCartQuantity('${product.id}', -1)" class="btn-secondary w-8 h-8 rounded-full flex items-center justify-center">-</button><span class="font-bold w-8 text-center">${itemInCart.quantity}</span><button onclick="window.app.addToCart('${product.id}')" class="btn-secondary w-8 h-8 rounded-full flex items-center justify-center">+</button></div>`
                        : `<button onclick="window.app.addToCart('${product.id}')" class="btn-primary py-2 px-4 rounded-lg text-sm flex items-center"><i data-lucide="plus" class="w-4 h-4 mr-1"></i><span>Tambah</span></button>`;
                    return `<div class="card overflow-hidden flex flex-col relative">
                                <button onclick="window.app.toggleFavorite('${product.id}')" class="absolute top-2 right-2 p-2 bg-white/70 rounded-full backdrop-blur-sm z-10">
                                    <i data-lucide="heart" class="w-5 h-5 ${isFavorite ? 'text-red-500 fill-current' : 'text-gray-500'}"></i>
                                </button>
                                <img src="${product.imageUrl}" alt="${product.name}" class="w-full h-40 object-cover">
                                <div class="p-4 flex flex-col flex-grow">
                                    <h3 class="text-lg font-bold text-gray-800">${product.name}</h3>
                                    <p class="text-sm text-gray-500">dari ${seller?.name || 'Penjual'}</p>
                                    <div class="flex-grow"></div>
                                    <div class="flex justify-between items-center mt-4">
                                        <span class="text-xl font-bold text-emerald-600">Rp ${product.price.toLocaleString('id-ID')}</span>
                                        ${actionButtonHTML}
                                    </div>
                                </div>
                            </div>`;
                }).join('');
            }

            const contentHTML = canteenIsOpen
                ? `<div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">${productCards.length > 0 ? productCards : '<p class="col-span-full text-center text-gray-500">Makanan tidak ditemukan.</p>'}</div>`
                : `<div class="text-center py-10 card max-w-lg mx-auto"><i data-lucide="clock" class="w-16 h-16 mx-auto text-gray-400"></i><h2 class="mt-4 text-xl font-bold">Kantin Sedang Tutup</h2><p class="text-gray-500">Silakan kembali lagi sesuai jadwal operasional.</p></div>`;


            return `<div class="bg-slate-50 min-h-screen">${AppHeader('Menu Kantin')}<main class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8"><div class="mb-6 relative"><input type="text" oninput="window.app.setSearchQuery(this.value)" value="${state.searchQuery}" placeholder="Cari makanan..." class="w-full pl-10 pr-4 py-3 rounded-full border border-gray-300 focus:ring-emerald-500 focus:border-emerald-500 shadow-sm"><i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"></i></div>${contentHTML}</main></div>`;
        }
        function PembeliCartPage() {
            const total = state.cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
            const cartItemsHTML = state.cart.map(item => `<div class="flex items-center justify-between py-4 border-b"><div class="flex items-center"><img src="${item.imageUrl}" alt="${item.name}" class="w-16 h-16 object-cover rounded-md mr-4"><div><p class="font-bold">${item.name}</p><p class="text-sm text-gray-500">Rp ${item.price.toLocaleString('id-ID')}</p></div></div><div class="flex items-center gap-2"><button onclick="window.app.updateCartQuantity('${item.id}', -1)" class="btn-secondary w-8 h-8 rounded-full">-</button><span class="font-bold w-8 text-center">${item.quantity}</span><button onclick="window.app.updateCartQuantity('${item.id}', 1)" class="btn-secondary w-8 h-8 rounded-full">+</button><button onclick="window.app.removeFromCart('${item.id}')" class="text-gray-400 hover:text-red-500 ml-2"><i data-lucide="trash-2" class="w-5 h-5"></i></button></div></div>`).join('');
            return `<div class="bg-slate-50 min-h-screen">${AppHeader('Keranjang Saya')}<main class="max-w-3xl mx-auto py-6 px-4 sm:px-6 lg:px-8"><div class="bg-white p-6 sm:p-8 rounded-lg shadow"><h2 class="text-2xl font-bold mb-6">Ringkasan Pesanan</h2>${state.cart.length > 0 ? `<div>${cartItemsHTML}</div><div class="mt-6 text-right"><p class="text-lg">Total: <span class="font-bold text-2xl text-emerald-600">Rp ${total.toLocaleString('id-ID')}</span></p><button onclick="window.app.checkout()" class="btn-primary py-3 px-8 rounded-lg mt-4">Pesan Sekarang</button></div>` : `<div class="text-center py-10"><i data-lucide="shopping-cart" class="w-16 h-16 mx-auto text-gray-300"></i><p class="mt-4 text-gray-500">Keranjang Anda masih kosong.</p><button onclick="window.app.navigateTo('pembeliMenu')" class="btn-primary py-2 px-4 rounded-lg mt-4">Lihat Menu</button></div>`}</div></main></div>`;
        }
        
        // --- Penjual (Seller) Views ---
        function PenjualDashboardPage() {
            const sellerProducts = mockProducts.filter(p => p.sellerId === state.currentUser.uid);
            const productListHTML = sellerProducts.map(product => `
                <tr class="border-b"><td class="py-3 px-4 flex items-center"><img src="${product.imageUrl}" alt="${product.name}" class="w-12 h-12 object-cover rounded-md mr-4"><span class="font-semibold">${product.name}</span></td><td class="py-3 px-4">Rp ${product.price.toLocaleString('id-ID')}</td><td class="py-3 px-4"><div class="flex items-center gap-2"><button onclick="window.app.openProductModal('${product.id}')" class="text-sky-600 hover:text-sky-800 p-2"><i data-lucide="edit" class="w-5 h-5"></i></button><button onclick="window.app.handleDeleteProduct('${product.id}')" class="text-rose-600 hover:text-rose-800 p-2"><i data-lucide="trash-2" class="w-5 h-5"></i></button></div></td></tr>`).join('');

            const sellerOrders = mockOrders.filter(o => o.sellerId === state.currentUser.uid);
            const orderListHTML = sellerOrders.map(order => {
                const buyer = mockUsers.find(u => u.uid === order.userId);
                const netIncome = order.status === 'completed' ? `Rp ${(order.total - (order.commission || 0)).toLocaleString('id-ID')}` : '-';
                return `<tr class="border-b"><td class="py-3 px-4 text-sm text-gray-500">...${order.id.slice(-6)}</td><td class="py-3 px-4 font-semibold">${buyer?.name || 'Unknown'}</td><td class="py-3 px-4">Rp ${order.total.toLocaleString('id-ID')}</td><td class="py-3 px-4 font-semibold text-emerald-700">${netIncome}</td><td class="py-3 px-4"><span class="status-badge status-${order.status}">${order.status}</span></td><td class="py-3 px-4">${order.status === 'pending' ? `<div class="flex items-center gap-2"><button onclick="window.app.updateOrderStatus('${order.id}', 'completed')" class="text-emerald-600 p-2" title="Selesaikan"><i data-lucide="check-circle"></i></button><button onclick="window.app.updateOrderStatus('${order.id}', 'cancelled')" class="text-rose-600 p-2" title="Batalkan"><i data-lucide="x-circle"></i></button></div>` : '-'}</td></tr>`;
            }).join('');
            
            const seller = mockUsers.find(u => u.uid === state.currentUser.uid);
            const storeStatusBadge = seller.storeStatus === 'open' 
                ? `<span class="status-badge status-completed">Buka</span>` 
                : `<span class="status-badge status-cancelled">Tutup</span>`;

            return `<div class="bg-slate-50 min-h-screen">${AppHeader('Dashboard Penjual')}<main class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8 space-y-8">
                <div class="bg-white p-6 sm:p-8 rounded-lg shadow">
                    <div class="flex justify-between items-center mb-4 flex-wrap gap-4">
                        <h2 class="text-2xl font-bold">Produk Saya</h2>
                        <div class="flex items-center gap-4">
                            <div class="flex items-center gap-2">
                                <span class="font-semibold text-sm sm:text-base">Status Toko:</span>${storeStatusBadge}
                                <button onclick="window.app.toggleStoreStatus('${state.currentUser.uid}')" class="btn-secondary py-1 px-3 rounded-lg text-sm">Ubah</button>
                            </div>
                            <button onclick="window.app.openProductModal()" class="btn-primary py-2 px-4 rounded-lg flex items-center gap-2"><i data-lucide="plus" class="w-5 h-5"></i><span>Tambah Produk</span></button>
                        </div>
                    </div>
                    <div class="overflow-x-auto"><table class="w-full text-left"><thead><tr class="bg-slate-50"><th class="py-3 px-4 font-semibold">Nama Produk</th><th class="py-3 px-4 font-semibold">Harga</th><th class="py-3 px-4 font-semibold">Aksi</th></tr></thead><tbody>${sellerProducts.length > 0 ? productListHTML : '<tr><td colspan="3" class="text-center py-8 text-gray-500">Anda belum memiliki produk.</td></tr>'}</tbody></table></div>
                </div>
                <div class="bg-white p-6 sm:p-8 rounded-lg shadow">
                    <h2 class="text-2xl font-bold mb-4">Pesanan Masuk</h2>
                    <div class="overflow-x-auto"><table class="w-full text-left"><thead><tr class="bg-slate-50"><th class="py-3 px-4 font-semibold">ID</th><th class="py-3 px-4 font-semibold">Pembeli</th><th class="py-3 px-4 font-semibold">Total</th><th class="py-3 px-4 font-semibold">Pendapatan Bersih</th><th class="py-3 px-4 font-semibold">Status</th><th class="py-3 px-4 font-semibold">Aksi</th></tr></thead><tbody>${sellerOrders.length > 0 ? orderListHTML : '<tr><td colspan="6" class="text-center py-8 text-gray-500">Belum ada pesanan yang masuk.</td></tr>'}</tbody></table></div>
                </div>
            </main></div>`;
        }

        // --- MODALS ---
        function ProductModal() {
            const isEditing = !!state.editingProduct;
            const product = state.editingProduct;
            return `<div class="modal-overlay" onclick="window.app.closeProductModal()"><div class="bg-white w-full max-w-lg rounded-lg shadow-xl p-8 animate-fade-in-up" onclick="event.stopPropagation()"><div class="flex justify-between items-center mb-6"><h2 class="text-2xl font-bold">${isEditing ? 'Edit Produk' : 'Tambah Produk Baru'}</h2><button onclick="window.app.closeProductModal()" class="text-gray-400 hover:text-gray-600 p-2 rounded-full -mr-2 -mt-2"><i data-lucide="x" class="w-6 h-6"></i></button></div><form onsubmit="window.app.handleProductFormSubmit(event)"><div class="space-y-4"><div><label for="product-name" class="block text-sm font-medium text-gray-700">Nama Produk</label><input type="text" id="product-name" name="name" value="${product?.name || ''}" required class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-emerald-500 focus:border-emerald-500"></div><div><label for="product-price" class="block text-sm font-medium text-gray-700">Harga</label><input type="number" id="product-price" name="price" value="${product?.price || ''}" required class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-emerald-500 focus:border-emerald-500"></div><div><label for="product-imageUrl" class="block text-sm font-medium text-gray-700">URL Gambar</label><input type="text" id="product-imageUrl" name="imageUrl" value="${product?.imageUrl || ''}" required class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-emerald-500 focus:border-emerald-500"></div></div><div class="mt-6 flex justify-end gap-4"><button type="button" onclick="window.app.closeProductModal()" class="btn-secondary py-2 px-4 rounded-lg">Batal</button><button type="submit" class="btn-primary py-2 px-4 rounded-lg">${isEditing ? 'Simpan Perubahan' : 'Tambah Produk'}</button></div></form></div></div>`;
        }
        function UserModal() {
            const isEditing = !!state.editingUser;
            const user = state.editingUser;
            return `<div class="modal-overlay" onclick="window.app.closeUserModal()"><div class="bg-white w-full max-w-lg rounded-lg shadow-xl p-8 animate-fade-in-up" onclick="event.stopPropagation()"><div class="flex justify-between items-center mb-6"><h2 class="text-2xl font-bold">${isEditing ? 'Edit Pengguna' : 'Tambah Pengguna Baru'}</h2><button onclick="window.app.closeUserModal()" class="text-gray-400 hover:text-gray-600 p-2 rounded-full -mr-2 -mt-2"><i data-lucide="x" class="w-6 h-6"></i></button></div><form onsubmit="window.app.handleUserFormSubmit(event)"><div class="space-y-4"><div><label for="user-name" class="block text-sm font-medium text-gray-700">Nama Lengkap</label><input type="text" id="user-name" name="name" value="${user?.name || ''}" required class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-emerald-500 focus:border-emerald-500"></div><div><label for="user-email" class="block text-sm font-medium text-gray-700">Email</label><input type="email" id="user-email" name="email" value="${user?.email || ''}" required class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-emerald-500 focus:border-emerald-500"></div><div id="password-field" style="${isEditing ? 'display: none;' : ''}"><label for="user-password" class="block text-sm font-medium text-gray-700">Sandi</label><input type="password" id="user-password" name="password" ${!isEditing ? 'required' : ''} class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-emerald-500 focus:border-emerald-500"></div><div><label for="user-role" class="block text-sm font-medium text-gray-700">Peran</label><select id="user-role" name="role" required class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-emerald-500 focus:border-emerald-500"><option value="pembeli" ${user?.role === 'pembeli' ? 'selected' : ''}>Siswa</option><option value="penjual" ${user?.role === 'penjual' ? 'selected' : ''}>Penjual Kantin</option><option value="admin" ${user?.role === 'admin' ? 'selected' : ''}>Admin</option></select></div></div><div class="mt-6 flex justify-end gap-4"><button type="button" onclick="window.app.closeUserModal()" class="btn-secondary py-2 px-4 rounded-lg">Batal</button><button type="submit" class="btn-primary py-2 px-4 rounded-lg">${isEditing ? 'Simpan Perubahan' : 'Tambah Pengguna'}</button></div></form></div></div>`;
        }
        function ComplaintModal() { return `<div class="modal-overlay" onclick="window.app.closeComplaintModal()"><div class="bg-white w-full max-w-lg rounded-lg shadow-xl p-8 animate-fade-in-up" onclick="event.stopPropagation()"><div class="flex justify-between items-center mb-6"><h2 class="text-2xl font-bold">Buat Laporan Pengaduan</h2><button onclick="window.app.closeComplaintModal()" class="p-2"><i data-lucide="x"></i></button></div><form onsubmit="window.app.handleComplaintSubmit(event)"><div class="space-y-4"><div><label for="subject" class="block text-sm font-medium">Subjek</label><input type="text" id="subject" name="subject" required class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-emerald-500 focus:border-emerald-500"></div><div><label for="description" class="block text-sm font-medium">Deskripsi Masalah</label><textarea id="description" name="description" required rows="4" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-emerald-500 focus:border-emerald-500"></textarea></div></div><div class="mt-6 flex justify-end gap-4"><button type="button" onclick="window.app.closeComplaintModal()" class="btn-secondary py-2 px-4 rounded-lg">Batal</button><button type="submit" class="btn-primary py-2 px-4 rounded-lg">Kirim Laporan</button></div></form></div></div>`; }
        
        // --- ADMIN VIEWS ---
        function AdminDashboardPage() { const views = { stats: AdminStatsView, users: AdminUsersView, sellers: AdminSellersView, products: AdminProductsView, orders: AdminOrdersView, finance: AdminFinanceView, complaints: AdminComplaintsView, settings: AdminSettingsView, }; const currentViewHTML = (views[state.adminCurrentView] || AdminStatsView)(); const navLinks = [ { view: 'stats', icon: 'bar-chart-2', label: 'Laporan Statistik' }, { view: 'users', icon: 'users', label: 'Manajemen Pengguna' }, { view: 'sellers', icon: 'store', label: 'Manajemen Penjual' }, { view: 'products', icon: 'shopping-basket', label: 'Manajemen Produk' }, { view: 'orders', icon: 'clipboard-list', label: 'Manajemen Pesanan' }, { view: 'finance', icon: 'wallet', label: 'Pembayaran & Keuangan' }, { view: 'complaints', icon: 'message-square-warning', label: 'Laporan Pengaduan' }, { view: 'settings', icon: 'settings', label: 'Pengaturan Aplikasi' }, ]; const sidebarHTML = navLinks.map(link => `<a href="#" onclick="event.preventDefault(); window.app.setAdminView('${link.view}')" class="admin-sidebar-link ${state.adminCurrentView === link.view ? 'active' : ''}"><i data-lucide="${link.icon}" class="w-5 h-5 mr-3"></i><span>${link.label}</span></a>`).join(''); return `<div class="min-h-screen bg-slate-100">${AppHeader('Dashboard Admin')}<div class="flex"><aside class="w-64 bg-white p-4 space-y-2 h-[calc(100vh-4rem)] sticky top-16"><nav>${sidebarHTML}</nav></aside><main class="flex-1 p-6">${currentViewHTML}</main></div></div>`; }
        function AdminStatsView() { const totalSales = mockOrders.filter(o => o.status === 'completed').reduce((sum, o) => sum + o.total, 0); const stats = [ { icon: 'wallet', label: 'Total Pendapatan Admin', value: `Rp ${adminEarnings.toLocaleString('id-ID')}`, color: 'emerald' }, { icon: 'dollar-sign', label: 'Total Volume Penjualan', value: `Rp ${totalSales.toLocaleString('id-ID')}`, color: 'emerald' }, { icon: 'users', label: 'Total Pengguna', value: mockUsers.length, color: 'sky' }, { icon: 'user', label: 'Siswa', value: mockUsers.filter(u=>u.role==='pembeli').length, color: 'sky' }, { icon: 'store', label: 'Penjual', value: mockUsers.filter(u=>u.role==='penjual').length, color: 'sky' }, { icon: 'shopping-basket', label: 'Total Produk', value: mockProducts.length, color: 'amber' }, { icon: 'clipboard-list', label: 'Total Pesanan', value: mockOrders.length, color: 'indigo' }, { icon: 'loader-2', label: 'Pesanan Pending', value: mockOrders.filter(o=>o.status==='pending').length, color: 'indigo' }, { icon: 'check-circle', label: 'Pesanan Selesai', value: mockOrders.filter(o=>o.status==='completed').length, color: 'indigo' }, ]; const statsHTML = stats.map(s => `<div class="bg-white p-6 rounded-lg shadow flex items-center gap-4"><i data-lucide="${s.icon}" class="w-12 h-12 text-${s.color}-500"></i><div><h3 class="text-sm font-semibold text-gray-500">${s.label}</h3><p class="text-2xl font-bold text-gray-800 mt-1">${s.value}</p></div></div>`).join(''); return `<h1 class="text-3xl font-bold mb-6">Laporan Statistik</h1><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">${statsHTML}</div>`; }
        function AdminUsersView() { const userList = mockUsers.map(user => { const userStatusClass = user.isActive ? 'bg-emerald-100 text-emerald-800' : 'bg-rose-100 text-rose-800'; return `<tr class="border-b"><td class="p-3">${user.name}</td><td class="p-3">${user.email}</td><td class="p-3 capitalize">${user.role}</td><td class="p-3"><span class="font-semibold capitalize p-2 rounded-md ${userStatusClass}">${user.isActive ? 'Aktif' : 'Nonaktif'}</span></td><td class="p-3"><div class="flex items-center gap-2"><button onclick="window.app.openUserModal('${user.uid}')" class="text-sky-600 p-2" title="Edit"><i data-lucide="edit"></i></button><button onclick="window.app.toggleUserStatus('${user.uid}')" class="text-rose-600 p-2" title="${user.isActive ? 'Nonaktifkan' : 'Aktifkan'}"><i data-lucide="${user.isActive ? 'user-x' : 'user-check'}"></i></button></div></td></tr>`; }).join(''); return `<div class="bg-white p-6 sm:p-8 rounded-lg shadow"><div class="flex justify-between items-center mb-4"><h2 class="text-2xl font-bold">Manajemen Pengguna</h2><button onclick="window.app.openUserModal()" class="btn-primary py-2 px-4 rounded-lg flex items-center gap-2"><i data-lucide="user-plus"></i><span>Tambah Pengguna</span></button></div><div class="overflow-x-auto"><table class="w-full text-left"><thead><tr class="bg-slate-100"><th class="p-3 font-semibold">Nama</th><th class="p-3 font-semibold">Email</th><th class="p-3 font-semibold">Peran</th><th class="p-3 font-semibold">Status</th><th class="p-3 font-semibold">Aksi</th></tr></thead><tbody>${userList}</tbody></table></div></div>`; }
        function AdminSellersView() { const sellerList = mockUsers.filter(u => u.role === 'penjual').map(user => { const statusClass = user.storeStatus === 'open' ? 'bg-emerald-100 text-emerald-800' : 'bg-rose-100 text-rose-800'; return `<tr class="border-b"><td class="p-3">${user.name}</td><td class="p-3">${user.email}</td><td class="p-3"><div class="flex items-center gap-2"><span class="font-semibold capitalize p-2 rounded-md ${statusClass}">${user.storeStatus === 'open' ? 'Buka' : 'Tutup'}</span><button onclick="window.app.toggleStoreStatus('${user.uid}')" class="text-sky-600 p-2" title="Ubah Status"><i data-lucide="repeat"></i></button></div></td></tr>`; }).join(''); return `<div class="bg-white p-6 sm:p-8 rounded-lg shadow"><h2 class="text-2xl font-bold mb-4">Manajemen Penjual</h2><div class="overflow-x-auto"><table class="w-full text-left"><thead><tr class="bg-slate-100"><th class="p-3 font-semibold">Nama Toko</th><th class="p-3 font-semibold">Email</th><th class="p-3 font-semibold">Status Toko</th></tr></thead><tbody>${sellerList}</tbody></table></div></div>`; }
        function AdminProductsView() { const productList = mockProducts.map(product => { const seller = mockUsers.find(u => u.uid === product.sellerId); return `<tr class="border-b"><td class="p-3 flex items-center"><img src="${product.imageUrl}" alt="${product.name}" class="w-12 h-12 object-cover rounded-md mr-4"><span class="font-semibold">${product.name}</span></td><td class="p-3">${seller ? seller.name : 'N/A'}</td><td class="p-3">Rp ${product.price.toLocaleString('id-ID')}</td><td class="p-3"><div class="flex items-center gap-2"><button onclick="window.app.openProductModal('${product.id}')" class="text-sky-600 p-2" title="Edit"><i data-lucide="edit"></i></button><button onclick="window.app.handleDeleteProduct('${product.id}')" class="text-rose-600 p-2" title="Hapus"><i data-lucide="trash-2"></i></button></div></td></tr>`; }).join(''); return `<div class="bg-white p-6 sm:p-8 rounded-lg shadow"><h2 class="text-2xl font-bold mb-4">Manajemen Produk</h2><div class="overflow-x-auto"><table class="w-full text-left"><thead><tr class="bg-slate-100"><th class="p-3 font-semibold">Produk</th><th class="p-3 font-semibold">Penjual</th><th class="p-3 font-semibold">Harga</th><th class="p-3 font-semibold">Aksi</th></tr></thead><tbody>${mockProducts.length > 0 ? productList : '<tr><td colspan="4" class="text-center p-8 text-gray-500">Tidak ada produk.</td></tr>'}</tbody></table></div></div>`; }
        function AdminOrdersView() { const orderList = mockOrders.map(order => { const buyer = mockUsers.find(u => u.uid === order.userId); const seller = mockUsers.find(u => u.uid === order.sellerId); return `<tr class="border-b"><td class="p-3">...${order.id.slice(-6)}</td><td class="p-3">${buyer?.name || 'N/A'}</td><td class="p-3">${seller?.name || 'N/A'}</td><td class="p-3">Rp ${order.total.toLocaleString('id-ID')}</td><td class="p-3"><span class="status-badge status-${order.status}">${order.status}</span></td><td class="p-3">${order.status === 'pending' ? `<div class="flex items-center gap-2"><button onclick="window.app.updateOrderStatus('${order.id}', 'completed')" class="text-emerald-600 p-2" title="Selesaikan"><i data-lucide="check-circle"></i></button><button onclick="window.app.updateOrderStatus('${order.id}', 'cancelled')" class="text-rose-600 p-2" title="Batalkan"><i data-lucide="x-circle"></i></button></div>` : '-'}</td></tr>`; }).join(''); return `<div class="bg-white p-6 sm:p-8 rounded-lg shadow"><h2 class="text-2xl font-bold mb-4">Manajemen Pesanan</h2><div class="overflow-x-auto"><table class="w-full text-left"><thead><tr class="bg-slate-100"><th class="p-3 font-semibold">ID</th><th class="p-3 font-semibold">Pembeli</th><th class="p-3 font-semibold">Penjual</th><th class="p-3 font-semibold">Total</th><th class="p-3 font-semibold">Status</th><th class="p-3 font-semibold">Aksi</th></tr></thead><tbody>${mockOrders.length > 0 ? orderList : '<tr><td colspan="6" class="text-center p-8 text-gray-500">Tidak ada pesanan.</td></tr>'}</tbody></table></div></div>`; }
        function AdminFinanceView() { const completedOrders = mockOrders.filter(o => o.status === 'completed'); const financeList = completedOrders.map(order => { const seller = mockUsers.find(u => u.uid === order.sellerId); const netIncome = order.total - order.commission; return `<tr class="border-b"><td class="p-3">...${order.id.slice(-6)}</td><td class="p-3">${seller?.name || 'N/A'}</td><td class="p-3">Rp ${order.total.toLocaleString('id-ID')}</td><td class="p-3 text-rose-600">Rp ${order.commission.toLocaleString('id-ID')}</td><td class="p-3 text-emerald-600 font-semibold">Rp ${netIncome.toLocaleString('id-ID')}</td></tr>`; }).join(''); return `<div class="bg-white p-6 sm:p-8 rounded-lg shadow"><h2 class="text-2xl font-bold mb-4">Pembayaran & Keuangan</h2><div class="overflow-x-auto"><table class="w-full text-left"><thead><tr class="bg-slate-100"><th class="p-3 font-semibold">ID Transaksi</th><th class="p-3 font-semibold">Penjual</th><th class="p-3 font-semibold">Total</th><th class="p-3 font-semibold">Komisi Admin</th><th class="p-3 font-semibold">Pendapatan Penjual</th></tr></thead><tbody>${financeList.length > 0 ? financeList : '<tr><td colspan="5" class="text-center p-8 text-gray-500">Tidak ada transaksi selesai.</td></tr>'}</tbody></table></div></div>`; }
        function AdminComplaintsView() { const complaintList = mockComplaints.map(c => { const user = mockUsers.find(u => u.uid === c.userId); return `<tr class="border-b"><td class="p-3">${user?.name || 'N/A'}</td><td class="p-3">${c.subject}</td><td class="p-3">${c.description}</td><td class="p-3"><span class="status-badge status-${c.status}">${c.status}</span></td><td class="p-3"><select onchange="window.app.updateComplaintStatus('${c.id}', this.value)" class="border rounded-md p-1"><option value="baru" ${c.status === 'baru' ? 'selected' : ''}>Baru</option><option value="diproses" ${c.status === 'diproses' ? 'selected' : ''}>Diproses</option><option value="selesai" ${c.status === 'selesai' ? 'selected' : ''}>Selesai</option></select></td></tr>`; }).join(''); return `<div class="bg-white p-6 sm:p-8 rounded-lg shadow"><h2 class="text-2xl font-bold mb-4">Laporan Pengaduan</h2><div class="overflow-x-auto"><table class="w-full text-left"><thead><tr class="bg-slate-100"><th class="p-3 font-semibold">Pelapor</th><th class="p-3 font-semibold">Subjek</th><th class="p-3 font-semibold">Deskripsi</th><th class="p-3 font-semibold">Status</th><th class="p-3 font-semibold">Aksi</th></tr></thead><tbody>${complaintList.length > 0 ? complaintList : '<tr><td colspan="5" class="text-center p-8 text-gray-500">Tidak ada pengaduan.</td></tr>'}</tbody></table></div></div>`; }
        function AdminSettingsView() { const scheduleDays = Object.keys(appSettings.canteenSchedule); const scheduleHTML = scheduleDays.map(day => { const schedule = appSettings.canteenSchedule[day]; return `<div class="grid grid-cols-4 items-center gap-4 py-2 border-b"><span class="capitalize font-medium">${day}</span><input type="time" name="${day}_open" value="${schedule.open}" class="border-gray-300 rounded-md shadow-sm w-full"><input type="time" name="${day}_close" value="${schedule.close}" class="border-gray-300 rounded-md shadow-sm w-full"><label class="flex items-center gap-2 cursor-pointer"><input type="checkbox" name="${day}_isOpen" ${schedule.isOpen ? 'checked' : ''} class="h-4 w-4 rounded text-emerald-600 focus:ring-emerald-500"> Buka</label></div>`; }).join(''); const roles = Object.keys(mockPermissions); const permissionsHTML = roles.map(role => `<div><h4 class="text-lg font-semibold capitalize mb-2">${role}</h4><div class="space-y-2">${mockPermissions[role].map(perm => `<label class="flex items-center gap-2"><input type="checkbox" ${perm.granted ? 'checked' : ''} disabled class="h-4 w-4 rounded text-gray-400"><span>${perm.label}</span></label>`).join('')}</div></div>`).join(''); const notificationsHTML = `<label class="flex items-center gap-2"><input type="checkbox" name="notif_newOrder" ${appSettings.notifications.newOrder ? 'checked' : ''} class="h-4 w-4 rounded text-emerald-600 focus:ring-emerald-500"><span>Notifikasi pesanan baru</span></label><label class="flex items-center gap-2"><input type="checkbox" name="notif_newComplaint" ${appSettings.notifications.newComplaint ? 'checked' : ''} class="h-4 w-4 rounded text-emerald-600 focus:ring-emerald-500"><span>Notifikasi pengaduan baru</span></label>`; return `<h1 class="text-3xl font-bold mb-6">Pengaturan Aplikasi</h1><div class="space-y-8"><form onsubmit="window.app.handleSettingsUpdate(event)" class="space-y-8"><div class="bg-white p-6 rounded-lg shadow"><h3 class="text-xl font-bold mb-4">Jadwal Buka Tutup Kantin</h3><div class="grid grid-cols-4 gap-4 font-semibold text-sm text-gray-500 px-2"><span>Hari</span><span>Jam Buka</span><span>Jam Tutup</span><span>Status</span></div>${scheduleHTML}</div><div class="bg-white p-6 rounded-lg shadow"><h3 class="text-xl font-bold mb-4">Pengaturan Notifikasi</h3><div class="space-y-3">${notificationsHTML}</div></div><div class="bg-white p-6 rounded-lg shadow"><h3 class="text-xl font-bold mb-4">Pengaturan Keuangan</h3><div><label for="commissionRate" class="block text-sm font-medium">Tingkat Komisi Admin (%)</label><input type="number" id="commissionRate" name="commissionRate" value="${appSettings.commissionRate}" min="0" max="100" step="1" required class="mt-1 block w-full max-w-xs border-gray-300 rounded-md shadow-sm focus:ring-emerald-500 focus:border-emerald-500"></div></div><div class="flex justify-end"><button type="submit" class="btn-primary py-2 px-6 rounded-lg">Simpan Semua Pengaturan</button></div></form><div class="bg-white p-6 rounded-lg shadow"><h3 class="text-xl font-bold mb-4">Peran dan Hak Akses</h3><p class="text-sm text-gray-500 mb-4">Bagian ini hanya untuk tampilan.</p><div class="grid grid-cols-1 md:grid-cols-3 gap-6">${permissionsHTML}</div></div><div class="bg-white p-6 rounded-lg shadow"><h3 class="text-xl font-bold mb-4">Backup & Restore Data</h3><div class="flex items-center gap-4 flex-wrap"><button onclick="window.app.handleBackupData()" class="btn-secondary py-2 px-4 rounded-lg flex items-center gap-2"><i data-lucide="download"></i>Backup Data</button><div class="border-l pl-4"><label for="restore-file" class="block text-sm font-medium mb-1">Pulihkan dari File (.json)</label><div class="flex items-center gap-2"><input type="file" id="restore-file" accept=".json" class="text-sm file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-emerald-50 file:text-emerald-700 hover:file:bg-emerald-100"><button type="button" onclick="window.app.handleRestoreData()" class="btn-primary py-2 px-4 rounded-lg flex items-center gap-2"><i data-lucide="upload"></i>Restore</button></div></div></div></div></div>`; }

        // --- Student Settings Views ---
        function PembeliSettingsPage() { const views = { profil: SettingsProfilView, keamanan: SettingsKeamananView, alamat: SettingsAlamatView, preferensi: SettingsPreferensiView, notifikasi: SettingsNotifikasiView, riwayat: SettingsRiwayatFavoritView, lainnya: SettingsLainnyaView, }; const currentViewHTML = (views[state.pembeliSettingsView] || SettingsProfilView)(); const navLinks = [ { view: 'profil', icon: 'user-circle', label: 'Info Profil' }, { view: 'keamanan', icon: 'shield', label: 'Keamanan Akun' }, { view: 'alamat', icon: 'map-pin', label: 'Alamat dan Lokasi' }, { view: 'preferensi', icon: 'sliders-horizontal', label: 'Preferensi Pesanan' }, { view: 'notifikasi', icon: 'bell', label: 'Notifikasi dan Privasi' }, { view: 'riwayat', icon: 'history', label: 'Riwayat dan Favorit' }, { view: 'lainnya', icon: 'more-horizontal', label: 'Lainnya' }, ]; const sidebarHTML = navLinks.map(link => `<a href="#" onclick="event.preventDefault(); window.app.setPembeliSettingsView('${link.view}')" class="admin-sidebar-link ${state.pembeliSettingsView === link.view ? 'active' : ''}"><i data-lucide="${link.icon}" class="w-5 h-5 mr-3"></i><span>${link.label}</span></a>`).join(''); return `<div class="min-h-screen bg-slate-100">${AppHeader('Pengaturan Akun')}<div class="flex"><aside class="w-64 bg-white p-4 space-y-2 h-[calc(100vh-4rem)] sticky top-16"><nav>${sidebarHTML}</nav></aside><main class="flex-1 p-6">${currentViewHTML}</main></div></div>`; }
        function SettingsProfilView() { const user = state.currentUser; return `<div class="bg-white p-6 sm:p-8 rounded-lg shadow max-w-2xl"><h2 class="text-2xl font-bold mb-6">Info Profil</h2><form onsubmit="window.app.handleProfileUpdate(event)"><div class="space-y-4"><div><label class="block text-sm font-medium">Nama Lengkap</label><input type="text" name="name" value="${user.name}" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm"></div><div><label class="block text-sm font-medium">Email</label><input type="email" name="email" value="${user.email}" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm"></div></div><div class="mt-6 flex justify-end"><button type="submit" class="btn-primary py-2 px-6 rounded-lg">Simpan</button></div></form></div>`; }
        function SettingsKeamananView() { return `<div class="bg-white p-6 sm:p-8 rounded-lg shadow max-w-2xl"><h2 class="text-2xl font-bold mb-6">Keamanan Akun</h2><form onsubmit="window.app.handlePasswordChange(event)"><div class="space-y-4"><div><label class="block text-sm font-medium">Sandi Lama</label><input type="password" name="oldPassword" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm"></div><div><label class="block text-sm font-medium">Sandi Baru</label><input type="password" name="newPassword" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm"></div><div><label class="block text-sm font-medium">Konfirmasi Sandi Baru</label><input type="password" name="confirmPassword" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm"></div></div><div class="mt-6 flex justify-end"><button type="submit" class="btn-primary py-2 px-6 rounded-lg">Ubah Sandi</button></div></form></div>`; }
        function SettingsAlamatView() { const user = state.currentUser; return `<div class="bg-white p-6 sm:p-8 rounded-lg shadow max-w-2xl"><h2 class="text-2xl font-bold mb-6">Alamat dan Lokasi</h2><form onsubmit="window.app.handleStudentSettingsUpdate(event)"><div class="space-y-4"><div><label class="block text-sm font-medium">Jalan</label><input type="text" name="street" value="${user.address?.street || ''}" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm"></div><div><label class="block text-sm font-medium">Kota</label><input type="text" name="city" value="${user.address?.city || ''}" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm"></div><div><label class="block text-sm font-medium">Catatan (cth: nomor rumah)</label><input type="text" name="note" value="${user.address?.note || ''}" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm"></div></div><div class="mt-6 flex justify-end"><button type="submit" class="btn-primary py-2 px-6 rounded-lg">Simpan Alamat</button></div></form></div>`; }
        function SettingsPreferensiView() { const user = state.currentUser; return `<div class="bg-white p-6 sm:p-8 rounded-lg shadow max-w-2xl"><h2 class="text-2xl font-bold mb-6">Preferensi Pesanan</h2><form onsubmit="window.app.handleStudentSettingsUpdate(event)"><div class="space-y-3"> <label class="flex items-center gap-2"><input type="checkbox" name="extraSauce" ${user.preferences?.extraSauce ? 'checked' : ''} class="h-4 w-4 rounded text-emerald-600"><span>Selalu minta saus sambal tambahan</span></label><label class="flex items-center gap-2"><input type="checkbox" name="noOnions" ${user.preferences?.noOnions ? 'checked' : ''} class="h-4 w-4 rounded text-emerald-600"><span>Jangan pakai bawang goreng</span></label></div><div class="mt-6 flex justify-end"><button type="submit" class="btn-primary py-2 px-6 rounded-lg">Simpan Preferensi</button></div></form></div>`; }
        function SettingsNotifikasiView() { const user = state.currentUser; return `<div class="bg-white p-6 sm:p-8 rounded-lg shadow max-w-2xl"><h2 class="text-2xl font-bold mb-6">Notifikasi dan Privasi</h2><form onsubmit="window.app.handleStudentSettingsUpdate(event)"><div class="space-y-3"><label class="flex items-center gap-2"><input type="checkbox" name="orderStatus" ${user.notificationSettings?.orderStatus ? 'checked' : ''} class="h-4 w-4 rounded text-emerald-600"><span>Notifikasi status pesanan</span></label><label class="flex items-center gap-2"><input type="checkbox" name="promos" ${user.notificationSettings?.promos ? 'checked' : ''} class="h-4 w-4 rounded text-emerald-600"><span>Notifikasi promo dan penawaran</span></label></div><div class="mt-6 flex justify-end"><button type="submit" class="btn-primary py-2 px-6 rounded-lg">Simpan</button></div></form></div>`; }
        function SettingsRiwayatFavoritView() { const user = state.currentUser; const userOrders = mockOrders.filter(o => o.userId === user.uid); const orderHistoryHTML = userOrders.map(order => `...`).join(''); const favoriteProducts = mockProducts.filter(p => user.favorites?.includes(p.id)); const favoritesHTML = favoriteProducts.map(p => `...`).join(''); return `<div class="space-y-8"><div class="bg-white p-6 sm:p-8 rounded-lg shadow"><h2 class="text-2xl font-bold mb-4">Riwayat Pesanan</h2>...</div><div class="bg-white p-6 sm:p-8 rounded-lg shadow"><h2 class="text-2xl font-bold mb-4">Makanan Favorit</h2>...</div></div>`; }
        function SettingsLainnyaView() { return `<div class="bg-white p-6 sm:p-8 rounded-lg shadow max-w-2xl"><h2 class="text-2xl font-bold mb-6">Lainnya</h2><div class="space-y-3"><a href="#" class="flex items-center text-emerald-600 hover:underline">Pusat Bantuan <i data-lucide="external-link" class="w-4 h-4 ml-2"></i></a><a href="#" class="flex items-center text-emerald-600 hover:underline">Tentang Aplikasi <i data-lucide="external-link" class="w-4 h-4 ml-2"></i></a></div></div>`; }

        // --- INITIAL LOAD ---
        document.addEventListener('DOMContentLoaded', () => {
            render();
            // Cek jika pengguna sudah login dari sesi sebelumnya (jika tidak pakai Supabase)
            // Jika Anda ingin menjaga login state tanpa database, Anda bisa gunakan localStorage.
            // Untuk sekarang, kita mulai dari halaman login.
            if (!state.currentUser) {
                navigateTo('login');
            }
        });
    </script>

</body>
</html>

